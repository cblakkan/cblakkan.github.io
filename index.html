<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#000000"/>

  <title>Cordell's Bike Map</title>
  <link rel="icon" href="bicycle.png">
  
  <link href='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css' rel='stylesheet' />
  <script src='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js'></script>
  <script type="text/javascript" src="bikeroutes.json"></script>
  
  <style>
    html, body {
        height: 100vh;
        width: 100%;
        margin: 0;
        padding: 0;
    }
    .wrapper {
        height: 100vh;
        width: 100%;
    }
    .map-wrapper {
        height: 100%;
        width: 100%;
    }
    #map {
        height: 100%;
        width: 100%;
    }
  </style>
</head>
<body>
    <div class="wrapper">
        <div class="map-wrapper">
            <div id="map"></div>
        </div>
    </div>

    <script>
        var map = new maplibregl.Map({
          container: 'map',
          style: 'https://api.maptiler.com/maps/b2512def-9887-424c-8274-dcae4a27558c/style.json?key=PhiQIVhvnvbs5yAOcy6M',
          center: [-73.97,40.68],
          zoom: 14
        });
        let LINE_WIDTH = 8;
        let OPACITY = 0.75;
        // NY MTA
        let PROTECTED_BIKELANE = '#00933C';
        let STANDARD_BIKELANE = '#0039A6';
        let SHARED_BIKELANE = '#FCCC0A';
        // 
        // let PROTECTED_BIKELANE = '#38E54D';
        // let STANDARD_BIKELANE = '#2192FF';
        // let SHARED_BIKELANE = '#FDFF00';

        
        map.on('load', () => {
            map.addSource('bikejson', {
                'type': 'geojson',
                'data': BIKEJSON
            })
                
            map.addLayer({
                'id': 'protected',
                'type': 'line',
                'source': 'bikejson',
                'paint': {
                    'line-color': PROTECTED_BIKELANE,
                    'line-width': LINE_WIDTH ,
                    'line-opacity': OPACITY
                },
                'filter': [
                    'any', 
                        ['==', ['get', 'ft_facilit'], 'Protected Path'],
                        ['==', ['get', 'tf_facilit'], 'Protected Path']
                    
                ]
            });
        
            map.addLayer({
                'id': 'greenway',
                'type': 'line',
                'source': 'bikejson',
                'paint': {
                    'line-color': PROTECTED_BIKELANE,
                    'line-width': LINE_WIDTH ,
                    'line-opacity': OPACITY
                },
                'filter': [
                    'any', 
                        ['==', ['get', 'ft_facilit'], 'Greenway'],
                        ['==', ['get', 'tf_facilit'], 'Greenway']
                    
                ]
            });
        
            map.addLayer({
                'id': 'standards',
                'type': 'line',
                'source': 'bikejson',
                'paint': {
                    'line-color': STANDARD_BIKELANE,
                    'line-width': LINE_WIDTH ,
                    'line-opacity': OPACITY
                },
                'filter': [
                    'any',
                        ['==', ['get', 'ft_facilit'], 'Standard'],
                        ['==', ['get', 'tf_facilit'], 'Standard']
                ]
            });
        
            map.addLayer({
                'id': 'sharrows',
                'type': 'line',
                'source': 'bikejson',
                'paint': {
                    'line-color': SHARED_BIKELANE,
                    'line-width': LINE_WIDTH ,
                    'line-opacity': OPACITY
                },
                'filter': [
                    'any',
                        ['==', ['get', 'ft_facilit'], 'Sharrows'],
                        ['==', ['get', 'tf_facilit'], 'Sharrows']
                ]
            });
        })

        var page   = document.getElementById('page'),
            ua     = navigator.userAgent,
            iphone = ~ua.indexOf('iPhone') || ~ua.indexOf('iPod');

        var setupScroll = window.onload = function() {
        // Start out by adding the height of the location bar to the width, so that
        // we can scroll past it
        if (iphone) {
            // iOS reliably returns the innerWindow size for documentElement.clientHeight
            // but window.innerHeight is sometimes the wrong value after rotating
            // the orientation
            var height = document.documentElement.clientHeight;
            // Only add extra padding to the height on iphone / ipod, since the ipad
            // browser doesn't scroll off the location bar.
            if (iphone && !fullscreen) height += 60;
            page.style.height = height + 'px';
        }
        // Scroll after a timeout, since iOS will scroll to the top of the page
        // after it fires the onload event
        setTimeout(scrollTo, 0, 0, 1);
        };
    </script>
</body>
</html>