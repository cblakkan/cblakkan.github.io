<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#000000"/>

  <title>Cordell's Bike Map</title>
  <link rel="icon" href="bicycle.png">
  <link rel="apple-touch-icon" href="bicycle.png">
  <meta name="apple-mobile-web-app-title" content="BikeMap">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <link href='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css' rel='stylesheet' />
  <script src='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js'></script>
  <script type="text/javascript" src="bikeroutes.json"></script>
  
  <style>
    html, body {
        height: 100vh;
        width: 100%;
        margin: 0;
        padding: 0;
    }
    .wrapper {
        height: 100vh;
        width: 100%;
    }
    .map-wrapper {
        height: 100%;
        width: 100%;
    }
    #map {
        height: 100%;
        width: 100%;
    }
    #fly-to-current-location {
        left: 10px;
        top: 10px;
        width: 20px;
        height: 20px;
        z-index: 10;
        background: #dcdcdc;
        position: absolute;
        border: 1px;
        text-align: center;
        border-color: black;
        border-style: solid;
    }
  </style>
</head>
<body>
    <div class="wrapper">
        <div id="fly-to-current-location">
            ‚òù
        </div>
        <div class="map-wrapper">
            <div id="map"></div>
        </div>
    </div>

    <script>
        let DEFAULT_CENTER = [-73.97, 40.68];
        let MAX_BOUNDS = [
            [-75.0, 40.0],
            [-73.0, 41.0]
        ];
        var map = new maplibregl.Map({
          container: 'map',
          style: 'https://api.maptiler.com/maps/b2512def-9887-424c-8274-dcae4a27558c/style.json?key=PhiQIVhvnvbs5yAOcy6M',
          center: DEFAULT_CENTER,
          maxBounds: MAX_BOUNDS,
          zoom: 14,
          minZoom: 11,
          maxZoom: 16,
          attributionControl: false
        });
        let LINE_WIDTH = 8;
        let OPACITY = 0.75;
        // NY MTA
        let SIDEWALK_BIKELANE = '#6CBE45';
        let PROTECTED_BIKELANE = '#00933C';
        let STANDARD_BIKELANE = '#0039A6';
        let SHARED_BIKELANE = '#FCCC0A';
        let BOGUS = 'purple'
        // 
        // let PROTECTED_BIKELANE = '#38E54D';
        // let STANDARD_BIKELANE = '#2192FF';
        // let SHARED_BIKELANE = '#FDFF00';
        
        map.on('load', () => {
            map.addSource('bikejson', {
                'type': 'geojson',
                'data': BIKEJSON
            })
                
            map.addLayer({
                'id': 'protected',
                'type': 'line',
                'source': 'bikejson',
                'paint': {
                    'line-color': PROTECTED_BIKELANE,
                    'line-width': LINE_WIDTH ,
                    'line-opacity': OPACITY
                },
                'filter': [
                    'any', 
                        ['==', ['get', 'ft_facilit'], 'Protected Path'],
                        ['==', ['get', 'tf_facilit'], 'Protected Path'],
                        ['==', ['get', 'tf2facilit'], 'Protected Path'],
                        ['==', ['get', 'ft2facilit'], 'Protected Path']
                    
                ]
            });
        
            map.addLayer({
                'id': 'greenway',
                'type': 'line',
                'source': 'bikejson',
                'paint': {
                    'line-color': PROTECTED_BIKELANE,
                    'line-width': LINE_WIDTH ,
                    'line-opacity': OPACITY
                },
                'filter': [
                    'any', 
                        ['==', ['get', 'ft_facilit'], 'Greenway'],
                        ['==', ['get', 'tf_facilit'], 'Greenway']
                    
                ]
            });

            map.addLayer({
                'id': 'sidewalk',
                'type': 'line',
                'source': 'bikejson',
                'paint': {
                    'line-color': SIDEWALK_BIKELANE,
                    'line-width': LINE_WIDTH,
                    'line-opacity': OPACITY
                },
                'filter': [
                    'any',
                        ['==', ['get', 'ft_facilit'], 'Sidewalk'],
                        ['==', ['get', 'tf_facilit'], 'Sidewalk']
                ]
            });
        
            map.addLayer({
                'id': 'standards',
                'type': 'line',
                'source': 'bikejson',
                'paint': {
                    'line-color': STANDARD_BIKELANE,
                    'line-width': LINE_WIDTH ,
                    'line-opacity': OPACITY
                },
                'filter': [
                    'any',
                        ['==', ['get', 'ft_facilit'], 'Standard'],
                        ['==', ['get', 'tf_facilit'], 'Standard']
                ]
            });

            map.addLayer({
                'id': 'bogus',
                'type': 'line',
                'source': 'bikejson',
                'paint': {
                    'line-color': STANDARD_BIKELANE,
                    'line-width': LINE_WIDTH ,
                    'line-opacity': OPACITY
                },
                'filter': [
                    'any',
                        ['==', ['get', 'ft_facilit'], 'Curbside'],
                        ['==', ['get', 'tf_facilit'], 'Curbside']
                ]
            });
        
            map.addLayer({
                'id': 'sharrows',
                'type': 'line',
                'source': 'bikejson',
                'paint': {
                    'line-color': SHARED_BIKELANE,
                    'line-width': LINE_WIDTH ,
                    'line-opacity': OPACITY
                },
                'filter': [
                    'any',
                        ['==', ['get', 'ft_facilit'], 'Sharrows'],
                        ['==', ['get', 'tf_facilit'], 'Sharrows'],
                        ['==', ['get', 'tf2facilit'], 'Sharrows'],
                        ['==', ['get', 'ft2facilit'], 'Sharrows']
                ]   
            });

            map.addLayer({
                'id': 'link',
                'type': 'line',
                'source': 'bikejson',
                'paint': {
                    'line-color': "red",
                    'line-width': 12,
                    'line-opacity': OPACITY
                },
                'filter': [
                    'any',
                        ['==', ['get', 'ft_facilit'], 'Link'],
                        ['==', ['get', 'tf_facilit'], 'Link'],
                ]
            });

            
        });

        function JumpToCurrentLocation(){
            window.navigator.geolocation.getCurrentPosition(function(position){
                let [minLong, minLat] = MAX_BOUNDS[0];
                let [maxLong, maxLat] = MAX_BOUNDS[1];
                let inBoundsLat = minLat <= position.coords.latitude && position.coords.latitude <= maxLat;
                let inBoundsLong = minLong <= position.coords.longitude && position.coords.longitude <= maxLong;
                if ( inBoundsLat && inBoundsLong ){
                    map.flyTo({center: [position.coords.longitude, position.coords.latitude]});
                }
            });
        }
        window.addEventListener("load", function(){
            JumpToCurrentLocation();
            document.getElementById('fly-to-current-location').addEventListener("click", function(){ JumpToCurrentLocation() });
        });
    </script>
</body>
</html>